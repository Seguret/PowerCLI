# POWERCLI SHELL
# pwsh

# INSTALL MODULE 
install-module -name VMware.PowerCLI

# IGNORE CERTIFICATE
Set-PowerCLIConfiguration -InvalidCertificateAction Ignore

# CONNECTION WITH VCSA
Connect-VIServer -server vcsa-gr.cioc.local -user t1.admin4@roc.cor -pass password

# CLUSTERS
Set-Variable -Name 'name_cluster' -Value (Get-Cluster | Select-Object -Property Name)
$name_cluster


# USERS
Set-Variable -Name 'users' -Value (Get-VIAccount -Domain roc.cor).name.Replace('ROC.COR\','')
$users

# GROUPS
Set-Variable -Name 'groups' -Value (Get-VIAccount -Group -Domain roc.cor).name.Replace('ROC.COR\co_','').Replace('goc_','')
$groups

# CONNECTION WITH SSOADMIN MODULE
Connect-SsoAdminServer -Server vcsa-gr.cioc.local -User t1.admin4@roc.cor -Password password -SkipCertificateCheck


# PERMISSION RESOURCE POOL
Get-ResourcePool -Name RSA | Get-VIPermission

# CREATE A NEW PERMISSION
$permission = New-VIPermission -Role GOC_Power_Users -Principal ROC.COR\m.dimaio -Entity (Get-ResourcePool -Name RSA)

# CREATE A NEW RESOURCEPOOL
New-ResourcePool -Location _RSA_Cluster -Name RSA_dev

# SEARCH FOLDER
$fold = (Get-Folder -Name susanna | Get-Folder)

# GET VM FROM HOST
Get-VM -Location esxidev06.roc.cor, esxidev05.roc.cor, esxigr2.cioc.local, esxigr4.cioc.local

#STOP VM
Get-VM -Name Kali_ADSL | Stop-VM -Confirm:$false

#STOP ALL VM
Stop-VM  -VM (Get-VM -Location esxidev06.roc.cor, esxidev05.roc.cor, esxigr2.cioc.local, esxigr4.cioc.local) -Confirm:$false

# GET DATASTORE
Get-Datastore -Name DEV07-SAS

$dest = Get-VMHost esxidev07.roc.cor
$vm = Get-VM -Name Kali_ADSL 
$destDatastore = Get-Datastore -Name DEV07-SAS

$vm | Move-VM -Destination $dest -Datastore $destDatastore